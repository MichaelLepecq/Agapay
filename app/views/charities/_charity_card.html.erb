<div class="col-xs-12 col-sm-6 col-md-4 card-wrapper">
  <%= link_to charity_path(charity) do %>
    <div class="card" >
      <div class="card-photo">
        <%= image_tag "#{charity.logo}" %>
      </div>
      <div class="card-category">
        <% charity.categories.each do |cat|   %>
          <% if cat.name == "arts-culture"  %>
            <div class="tag-<%= cat.name %> tags">Arts & Culture</div>
          <% elsif cat.name == "indigenous-peoples"  %>
            <div class="tag-<%= cat.name %> tags">Indigenous Peoples</div>
          <% elsif cat.name == "social-services"  %>
            <div class="tag-<%= cat.name %> tags">Social Services</div>
          <% else %>
            <div class="tag-<%= cat.name %> tags"><%= cat.name.capitalize %></div>
          <% end %>
        <% end %>
      </div>
      <div class="card-content">
        <h2>
          <%= charity.name.upcase %>
        </h2>
        <p> <%= sanitize(truncate(charity.description, length: 150)) %></p>
      </div>
      <div class="card-hover">

      </div>
    </div>
  <% end %>
  <div class="card-favorite">
    <div id="fav-<%= charity.id %>" class="<%= charity.liked(current_user) ? 'liked' : '' %>">
      <%= link_to charity_favorite_path(charity), method: :post, remote: :true do  %>
          <%= inline_svg('empty_heart')%>
      <% end %>
    </div>
  </div>
  <div class="card-buttons">
    <%= image_tag "dislike.png", height: '18%', width: '18%'%>
    <%= link_to("#", { class: "donatecard-button", "data-toggle" => "modal", "data-target" => "#charity-modal-#{charity.id}" }) do %>
     <%= image_tag "donate.png" %>
    <% end %>
  </div>
</div>

<div class="modal fade bd-example-modal-lg" id="charity-modal-<%= charity.id %>" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-content">
      <div class="col-xs-12 col-sm-4 col-sm-offset-4 form-login">
      <h2>Your Donation:</h2>
      <%= simple_form_for @donation, url: charity_payments_url(charity), html: { id: "donation-form-#{charity.id}" } do |f| %>
        <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
        <%= f.input(:donation_amount, { label: false, as: :slider, min: 0, max: 100, input_html: { id: "donation-amount-#{charity.id}"}}) %>
        <%= hidden_field_tag "stripe_token", nil, id: "stipe-token-#{charity.id}" %>

        <%# if user_signed_in? %>
          <button id="donate-button-<%= charity.id %>">Donate</button>
        <%# #else %>
          <%#= link_to t(".sign_in", default: "Login"), new_user_session_path %>
        <%# end %>

      <% end %>
    </div>
  </div>
</div>

<%= content_for(:after_js) do %>
  <script>
   <% if user_signed_in? %>
    document.getElementById("donate-button-<%= charity.id %>").addEventListener("click", function(event) {
      StripeCheckout.configure({
        // source: "slksm;lkbms;lbkms;blks",
        key: "<%= Rails.configuration.stripe[:publishable_key] %>",
        token: function(token) {
          document.getElementById("stipe-token-<%= charity.id %>").value = token.id;
          document.getElementById("donation-form-<%= charity.id %>").submit();
        }
      }).open({
        amount: parseInt(document.getElementById("donation-amount-<%= charity.id %>").value) * 100,
        name: "Donate",
        email: "<%= current_user.email %>"
      });

      event.preventDefault();
    });
    <% end %>
  </script>
<% end %>
